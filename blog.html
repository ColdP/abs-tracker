<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>腹肌训练追踪 - 博客</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Manrope -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Manrope', sans-serif;
            background-color: #f3f4f6;
        }
        .m3-surface {
            background-color: #ffffff;
            border-radius: 1.75rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .m3-primary-text {
            color: #005ac1;
        }
        .m3-primary-bg {
            background-color: #d8e2ff;
        }
    </style>
</head>
<body class="bg-blue-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-3xl">
        
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-4xl font-extrabold m3-primary-text">成长日记</h1>
                <p class="text-gray-500 mt-1">记录每一滴汗水。</p>
            </div>
            <nav class="flex gap-2">
                <a href="./index.html" class="px-4 py-2 hover:bg-blue-100 rounded-full">状态</a>
                <a href="./tracker.html" class="px-4 py-2 hover:bg-blue-100 rounded-full">记录</a>
                <a href="./blog.html" class="px-4 py-2 m3-primary-bg text-blue-800 font-bold rounded-full">博客</a>
            </nav>
        </header>

        <main id="blog-container" class="space-y-8">
            <!-- Blog posts will be loaded here -->
            <p id="loading-message" class="text-gray-500 text-center py-16">正在加载博客文章...</p>
        </main>

        <footer class="text-center text-gray-400 mt-12">
            <p>&copy; 2024 腹肌训练追踪器.</p>
        </footer>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Your Firebase project configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC7XJuqUZrNbnuWZMIn3XBBctIYDwsZ4kE",
            authDomain: "my-abs-tracker-0.firebaseapp.com",
            projectId: "my-abs-tracker-0",
            storageBucket: "my-abs-tracker-0.firebasestorage.app",
            messagingSenderId: "799705014883",
            appId: "1:799705014883:web:3d340de1088848cb3f8e56",
            measurementId: "G-KWTCEWNW1Q"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'my-abs-tracker-0';

        // Function to render blog posts
        function renderPosts(posts) {
            const container = document.getElementById('blog-container');
            container.innerHTML = ''; // Clear loading message

            if (posts.length === 0) {
                container.innerHTML = `<p class="text-gray-500 text-center py-16">还没有任何博客文章。去<a href="./tracker.html" class="m3-primary-text font-bold">记录</a>第一篇吧！</p>`;
                return;
            }

            // Sort posts by date, descending
            posts.sort((a, b) => b.date.seconds - a.date.seconds);

            posts.forEach(post => {
                const postDate = new Date(post.date.seconds * 1000);
                const dateString = postDate.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' });
                
                const postElement = `
                    <article class="m3-surface overflow-hidden">
                        ${post.photoUrl ? `<img src="${post.photoUrl}" alt="每日照片" class="w-full h-auto object-cover">` : ''}
                        <div class="p-6">
                            <p class="text-sm text-gray-500 mb-2">${dateString}</p>
                            <p class="text-gray-700 whitespace-pre-wrap">${post.notes || '今天没有写下感想。'}</p>
                        </div>
                    </article>
                `;
                container.innerHTML += postElement;
            });
        }

        // Main function to fetch and display data
        async function main() {
            try {
                const logsCollection = collection(db, `artifacts/${appId}/public/data/workout_logs`);
                const querySnapshot = await getDocs(logsCollection);
                
                const posts = [];
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    // Only show posts with a photo or notes
                    if (data.photoUrl || data.notes) {
                        posts.push(data);
                    }
                });

                renderPosts(posts);

            } catch (error) {
                console.error("加载博客数据失败:", error);
                document.getElementById('blog-container').innerHTML = '<p class="text-red-500 text-center py-16">加载数据失败，请检查 Firebase 配置或网络连接。</p>';
            }
        }

        // Run on page load
        window.onload = main;
    </script>
</body>
</html>
